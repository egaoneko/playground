{"version":3,"sources":["webpack:///./mapbox-sprites-canvas.js"],"names":["mapboxgl","accessToken","const","map","Map","container","style","center","zoom","sprites","sprite01","x","y","w","h","sprite02","sprite03","sprite04","on","spriteSheet","Promise","resolve","reject","loadedSprites","loadedSpriteSheet","Image","src","onload","Object","keys","forEach","name","push","spriteName","canvas","document","createElement","ctx","getContext","sprite","width","height","drawImage","getSprite","onerror","e","getSpritesFromCanvas","then","spritesCount","length","images","Array","i","ref","image","addImage","getImageData","features","type","geometry","coordinates","Math","random","properties","icon","addSource","data","addLayer","id","source","layout","icon-image","icon-size"],"mappings":"2EACAA,SAASC,YADG,6FAGZC,IAAMC,EAAM,IAAIH,SAASI,KACvBC,UAAW,MACXC,MAAO,oCACPC,QAAS,EAAG,GACZC,KAAM,IAGFC,GACJC,UACEC,EAAG,EACHC,EAAG,EACHC,EAAG,GACHC,EAAG,IAELC,UACEJ,EAAG,IACHC,EAAG,GACHC,EAAG,GACHC,EAAG,IAELE,UACEL,EAAG,GACHC,EAAG,EACHC,EAAG,GACHC,EAAG,IAELG,UACEN,EAAG,IACHC,EAAG,EACHC,EAAG,GACHC,EAAG,KAIPX,EAAIe,GAAG,OAAM,YAoDb,SAA8BC,EAAaV,GACzC,OAAO,IAAIW,QAAO,SAAEC,EAASC,GAC3BpB,IAAMqB,KACAC,EAAoB,IAAIC,MAE9BD,EAAkBE,IAAMP,EACxBK,EAAkBG,OAAM,WACtBC,OACGC,KAAKpB,GACLqB,QAAO,SAACC,GACPR,EAAcS,MAAMD,EAU9B,SAAmBZ,EAAaV,EAASwB,GACvC/B,IAAMgC,EAASC,SAASC,cAAc,UAChCC,EAAMH,EAAOI,WAAW,MACxBC,EAAS9B,EAAQwB,GASvB,OAPAC,EAAOM,MAAQD,EAAO1B,EACtBqB,EAAOO,OAASF,EAAOzB,EACvBuB,EAAIK,UAAUvB,EACZoB,EAAO5B,EAAG4B,EAAO3B,EAAG2B,EAAO1B,EAAG0B,EAAOzB,EACrC,EAAG,EAAGyB,EAAO1B,EAAG0B,EAAOzB,GAGlBoB,EAtB2BS,CAAUnB,EAAmBf,EAASsB,OAEpEV,EAAQE,IAEVC,EAAkBoB,QAAO,SAAGC,GAC1BvB,EAAOuB,OAlEXC,CAAqB,yBAA0BrC,GAC5CsC,KAAI,SAACtC,GAIJ,IAFAP,IAAM8C,EAAevC,EAAQwC,OACvBC,EAAS,IAAIC,MAAMH,GAChBI,EAAI,EAAGA,EAAIJ,IAAgBI,EAAG,CACrC,IAAAC,EAAsB5C,EAAQ2C,GAAvBrB,EAAAsB,EAAA,GAAMC,EAAAD,EAAA,GACPhB,EAAMiB,EAAMhB,WAAW,MAC7BnC,EAAIoD,SAASxB,EAAMM,EAAImB,aAAa,EAAG,EAAGF,EAAMd,MAAOc,EAAMb,SAC7DS,EAAOE,GAAKrB,EAOd,IAJA7B,IACMuD,EAAW,IAAIN,MADA,KAIZC,EAAI,EAAGA,EAJK,MAIeA,EAClCK,EAASL,IACPM,KAAM,UACNC,UACED,KAAM,QACNE,aAAc,IAAUC,KAAKC,SAPvB,IAOuC,IAAUD,KAAKC,SANtD,KAQRC,YACEC,KAAMd,EAAOE,GAAKJ,EAAe,MAKvC7C,EAAI8D,UACF,UAEEP,KAAM,UACNQ,MACER,KAAM,oBACND,SAAUA,KAIhBtD,EAAIgE,UACFC,GAAM,SACNV,KAAQ,SACRW,OAAU,SACVC,QACEC,aAAc,SACdC,YAAa","file":"mapbox-sprites-canvas.js","sourcesContent":["const key = 'pk.eyJ1IjoiZWdhb25la28iLCJhIjoiY2pkYnJtdWg4N3Y0ejMzbzV2NHkzanJodCJ9.509Ns7trg6hi_lZKGyWzew';\nmapboxgl.accessToken = key;\n\nconst map = new mapboxgl.Map({\n  container: 'map',\n  style: 'mapbox://styles/mapbox/streets-v9',\n  center: [0, 0],\n  zoom: 1\n});\n\nconst sprites = {\n  'sprite01': {\n    x: 0,\n    y: 0,\n    w: 55,\n    h: 55\n  },\n  'sprite02': {\n    x: 110,\n    y: 86,\n    w: 55,\n    h: 55\n  },\n  'sprite03': {\n    x: 55,\n    y: 0,\n    w: 55,\n    h: 86\n  },\n  'sprite04': {\n    x: 212,\n    y: 0,\n    w: 44,\n    h: 44\n  }\n};\n\nmap.on('load', () => {\n  getSpritesFromCanvas('data/img/butterfly.png', sprites)\n    .then(sprites => {\n\n      const spritesCount = sprites.length;\n      const images = new Array(spritesCount);\n      for (let i = 0; i < spritesCount; ++i) {\n        const [name, image] = sprites[i];\n        const ctx = image.getContext('2d');\n        map.addImage(name, ctx.getImageData(0, 0, image.width, image.height));\n        images[i] = name;\n      }\n\n      const featureCount = 500;\n      const features = new Array(featureCount);\n      const lng = 180;\n      const lat = 90;\n      for (let i = 0; i < featureCount; ++i) {\n        features[i] = {\n          type: \"Feature\",\n          geometry: {\n            type: \"Point\",\n            coordinates: [2 * lng * Math.random() - lng, 2 * lat * Math.random() - lat],\n          },\n          properties: {\n            icon: images[i % (spritesCount - 1)]\n          }\n        };\n      }\n\n      map.addSource(\n        \"points\",\n        {\n          type: \"geojson\",\n          data: {\n            type: \"FeatureCollection\",\n            features: features,\n          }\n        });\n\n      map.addLayer({\n        \"id\": \"points\",\n        \"type\": \"symbol\",\n        \"source\": \"points\",\n        \"layout\": {\n          \"icon-image\": \"{icon}\",\n          \"icon-size\": 1\n        }\n      });\n    });\n});\n\nfunction getSpritesFromCanvas(spriteSheet, sprites) {\n  return new Promise((resolve, reject) => {\n    const loadedSprites = [];\n    const loadedSpriteSheet = new Image();\n\n    loadedSpriteSheet.src = spriteSheet;\n    loadedSpriteSheet.onload = () => {\n      Object\n        .keys(sprites)\n        .forEach(name => {\n          loadedSprites.push([name, getSprite(loadedSpriteSheet, sprites, name)]);\n        });\n      resolve(loadedSprites);\n    };\n    loadedSpriteSheet.onerror = e => {\n      reject(e);\n    }\n  });\n}\n\nfunction getSprite(spriteSheet, sprites, spriteName) {\n  const canvas = document.createElement('CANVAS');\n  const ctx = canvas.getContext('2d');\n  const sprite = sprites[spriteName];\n\n  canvas.width = sprite.w;\n  canvas.height = sprite.h;\n  ctx.drawImage(spriteSheet,\n    sprite.x, sprite.y, sprite.w, sprite.h,\n    0, 0, sprite.w, sprite.h\n  );\n\n  return canvas;\n}\n"],"sourceRoot":""}