(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{45:function(e,n){var t,o,r,i,a,s,c,d=45,l=.1,E=2e3,h=200,u=[],p=new THREE.Raycaster,w=new THREE.Vector2;function f(){i=s.clientWidth,a=s.clientHeight,r.aspect=i/a,r.updateProjectionMatrix(),t.setSize(i,a)}function T(e){var n=new THREE.LineBasicMaterial({color:16777215}),t=new THREE.Geometry;return e.forEach(function(e){var n=m(e[0],e[1],h);t.vertices.push(n)}),new THREE.Line(t,n)}function v(e){w.x=e.clientX/window.innerWidth*2-1,w.y=-e.clientY/window.innerHeight*2+1,p.setFromCamera(w,r);for(var n=p.intersectObject(c,!0),t=0;t<n.length;t++)console.log(H(n[t].point))}function g(e){w.x=e.clientX/window.innerWidth*2-1,w.y=-e.clientY/window.innerHeight*2+1,p.setFromCamera(w,r);for(var n=p.intersectObject(c,!0),t=0;t<n.length;t++){var i=new THREE.SphereGeometry(.5),a=new THREE.MeshBasicMaterial({color:"#ff0000"}),s=new THREE.Mesh(i,a);s.position.copy(n[t].point),o.add(s)}}function m(e,n,t){var o=R(90-n),r=R(e+180),i=-t*Math.sin(o)*Math.cos(r),a=t*Math.sin(o)*Math.sin(r),s=t*Math.cos(o);return new THREE.Vector3(i,s,a)}function H(e){e.normalize();var n=(270+y(Math.atan2(e.x,e.z)))%360,t=new THREE.Vector3(e.x,0,e.z);t.normalize();var o=y(Math.acos(t.dot(e)));return e.y<0&&(o*=-1),[n,o]}function R(e){return e*(Math.PI/180)}function y(e){return e*(180/Math.PI)}proj4.defs([["Globe","+proj=longlat +a=6367470 +b=6367470 +ellps=sphere +datum=WGS84 +units=degrees"]]),function(){s=document.getElementById("container"),i=s.clientWidth,a=s.clientHeight,(o=new THREE.Scene({antialias:!0})).background=new THREE.Color(0),o.fog=new THREE.FogExp2(0,3e-4),(r=new THREE.PerspectiveCamera(d,i/a,l,E)).position.set(0,0,1e3);var e=new THREE.PointLight(16777215);e.position.set(10,50,400),o.add(e);var n=h;c=new THREE.Group,o.add(c),(new THREE.TextureLoader).load("http://i.imgur.com/puZgGjm.jpg",function(e){var t=new THREE.SphereGeometry(n,50,50),o=new THREE.MeshBasicMaterial({map:e,overdraw:.5,transparent:!0,opacity:.5}),r=new THREE.Mesh(t,o);c.add(r)});for(var p=new THREE.SphereGeometry(1e3,100,50),w=new THREE.PointsMaterial({size:1,opacity:.7}),H=0;H<45e3;H++){var R=new THREE.Vector3;R.x=(1e3*Math.random()+1e3)*(Math.round(Math.random())?1:-1),R.y=(1e3*Math.random()+1e3)*(Math.round(Math.random())?1:-1),R.z=(1e3*Math.random()+1e3)*(Math.round(Math.random())?1:-1),p.vertices.push(R)}var y=new THREE.Points(p,w);o.add(y),(t=new THREE.WebGLRenderer({alpha:!0,antialias:!0})).setClearColor(268435455,0),t.setPixelRatio(window.devicePixelRatio),t.setSize(i,a),s.appendChild(t.domElement);var M=new THREE.OrbitControls(r,t.domElement);M.screenSpacePanning=!0,M.minDistance=300,M.maxDistance=E,window.addEventListener("resize",f,!1),window.addEventListener("click",v),window.addEventListener("dblclick",g),fetch("data/geojson/capitals.geojson").then(function(e){return e.json()}).then(function(e){(u=e.features.map(function(e){return Object.assign({},e.properties,{coordinates:turf.getCoord(e)})}).filter(function(e){return e.city})).forEach(function(e){var n=e.coordinates,t=n[0],r=n[1],i=new THREE.SphereGeometry(1),a=new THREE.MeshBasicMaterial({color:"#ff0000"}),s=new THREE.Mesh(i,a),c=m(t,r,h);s.position.copy(c),o.add(s),e.position=c,e.sphere=s;var d=function(e,n){void 0===n&&(n={});var t=n.hasOwnProperty("fontface")?n.fontface:"Arial",o=n.hasOwnProperty("fontsize")?n.fontsize:18,r=n.hasOwnProperty("borderThickness")?n.borderThickness:4,i=n.hasOwnProperty("borderColor")?n.borderColor:{r:0,g:0,b:0,a:1},a=n.hasOwnProperty("backgroundColor")?n.backgroundColor:{r:255,g:255,b:255,a:1},s=n.hasOwnProperty("textColor")?n.textColor:{r:0,g:0,b:0,a:1},c=document.createElement("canvas"),d=c.getContext("2d");d.font="Bold "+o+"px "+t;var l=d.measureText(e).width;d.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",d.strokeStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",d.lineWidth=r,function(e,n,t,o,r,i){e.beginPath(),e.moveTo(n+i,t),e.lineTo(n+o-i,t),e.quadraticCurveTo(n+o,t,n+o,t+i),e.lineTo(n+o,t+r-i),e.quadraticCurveTo(n+o,t+r,n+o-i,t+r),e.lineTo(n+i,t+r),e.quadraticCurveTo(n,t+r,n,t+r-i),e.lineTo(n,t+i),e.quadraticCurveTo(n,t,n+i,t),e.closePath(),e.fill(),e.stroke()}(d,r/2,r/2,1.1*(l+r),1.4*o+r,8),d.fillStyle="rgba("+s.r+", "+s.g+", "+s.b+", 1.0)",d.fillText(e,r,o+r);var E=new THREE.Texture(c);E.needsUpdate=!0;var h=new THREE.SpriteMaterial({map:E}),u=new THREE.Sprite(h);return u.scale.set(.5*o,.25*o,.75*o),u}(e.city,{fontsize:50});d.position.copy(m(t,r,h+10)),o.add(d),e.text=d})}),fetch("data/geojson/countries.geojson").then(function(e){return e.json()}).then(function(e){var n=e.features;n.forEach(function(e){var n=e.geometry.type;"Polygon"===n?o.add(T(e.geometry.coordinates[0])):"MultiPolygon"===n&&e.geometry.coordinates.forEach(function(e){return o.add(T(e[0]))})})})}(),function e(){requestAnimationFrame(e);t.render(o,r),u.forEach(function(e){c.position.distanceTo(r.position)<e.position.distanceTo(r.position)?(e.sphere.visible=!1,e.text.visible=!1):(e.sphere.visible=!0,e.text.visible=!0)})}()}},[[45,0]]]);
//# sourceMappingURL=three-globe.js.map