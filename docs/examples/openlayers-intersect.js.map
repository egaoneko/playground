{"version":3,"sources":["webpack:///./openlayers-intersect.js"],"names":["const","stroke","ol","style","Stroke","color","width","fill","Fill","styles","square","Style","image","RegularShape","points","radius","angle","Math","PI","triangle","rotation","star","radius2","cross","x","styleKeys","features","Array","e","i","styleKey","floor","random","coordinates","Feature","geom","Point","setStyle","setProperties","key","source","Vector","vectorLayer","layer","map","Map","layers","target","view","View","center","zoom","drawFeatureBox","container","document","querySelector","prevFeatureBox","removeChild","frag","createDocumentFragment","ref","getBoxInfo","topRect","leftRect","bottomRect","rightRect","box","createElement","id","className","appendChild","top","cssText","left","bottom","right","containerRect","getBoundingClientRect","y","height","boxRect","on","sw","getCoordinateFromPixel","ne","extent","boundingExtent","getFeatures","filter","feature","intersects","getGeometry","getExtent","totalCount","length","keyCount","forEach","getProperties","has","set","get","keyCountText","entries","next","done","entry","value","push","getElementById","innerHTML","join","window","addEventListener"],"mappings":"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","file":"openlayers-intersect.js","sourcesContent":["const stroke = new ol.style.Stroke({color: 'black', width: 2});\nconst fill = new ol.style.Fill({color: 'red'});\n\nconst styles = {\n  'square': new ol.style.Style({\n    image: new ol.style.RegularShape({\n      fill: fill,\n      stroke: stroke,\n      points: 4,\n      radius: 10,\n      angle: Math.PI / 4\n    })\n  }),\n  'triangle': new ol.style.Style({\n    image: new ol.style.RegularShape({\n      fill: fill,\n      stroke: stroke,\n      points: 3,\n      radius: 10,\n      rotation: Math.PI / 4,\n      angle: 0\n    })\n  }),\n  'star': new ol.style.Style({\n    image: new ol.style.RegularShape({\n      fill: fill,\n      stroke: stroke,\n      points: 5,\n      radius: 10,\n      radius2: 4,\n      angle: 0\n    })\n  }),\n  'cross': new ol.style.Style({\n    image: new ol.style.RegularShape({\n      fill: fill,\n      stroke: stroke,\n      points: 4,\n      radius: 10,\n      radius2: 0,\n      angle: 0\n    })\n  }),\n  'x': new ol.style.Style({\n    image: new ol.style.RegularShape({\n      fill: fill,\n      stroke: stroke,\n      points: 4,\n      radius: 10,\n      radius2: 0,\n      angle: Math.PI / 4\n    })\n  })\n};\n\nconst styleKeys = ['x', 'cross', 'star', 'triangle', 'square'];\nconst count = 250;\nconst features = new Array(count);\nconst e = 4500000;\nfor (let i = 0; i < count; ++i) {\n  const styleKey = styleKeys[Math.floor(Math.random() * 5)];\n  const coordinates = [2 * e * Math.random() - e, 2 * e * Math.random() - e];\n  features[i] = new ol.Feature(new ol.geom.Point(coordinates));\n  features[i].setStyle(styles[styleKey]);\n  features[i].setProperties({\n    key: styleKey,\n  });\n}\n\nconst source = new ol.source.Vector({\n  features: features\n});\n\nconst vectorLayer = new ol.layer.Vector({\n  source: source\n});\n\nconst map = new ol.Map({\n  layers: [\n    vectorLayer\n  ],\n  target: 'map',\n  view: new ol.View({\n    center: [0, 0],\n    zoom: 2\n  })\n});\n\nmap.on('postcompose', () => {\n  const container = document.querySelector('#container');\n  const {boxRect} = getBoxInfo(container);\n\n  const sw = map.getCoordinateFromPixel([boxRect.left, boxRect.bottom]);\n  const ne = map.getCoordinateFromPixel([boxRect.right, boxRect.top]);\n  const extent = ol.extent.boundingExtent([sw, ne]);\n  const features = source\n    .getFeatures()\n    .filter((feature) => {\n      return ol.extent.intersects(extent, feature.getGeometry().getExtent());\n    });\n\n  const totalCount = features.length;\n  const keyCount = new Map();\n\n  features.forEach((feature) => {\n    const properties = feature.getProperties();\n    const key = properties['key'];\n\n    if (!keyCount.has(key)) {\n      keyCount.set(key, 1);\n      return;\n    }\n\n    keyCount.set(key, keyCount.get(key) + 1);\n  });\n\n  const keyCountText = [];\n  const entries = keyCount.entries();\n  let next = entries.next();\n\n  while (!next.done) {\n    const entry = next.value;\n    keyCountText.push(`${entry[0]}: ${entry[1]}`);\n    next = entries.next();\n  }\n\n  const info = document.getElementById('info');\n  info.innerHTML = `Total: ${totalCount}` + (keyCountText.length > 0 ? ', ' + keyCountText.join(', ') : '');\n});\n\nfunction drawFeatureBox() {\n  const container = document.querySelector('#container');\n  const prevFeatureBox = document.querySelector('#feature-box');\n\n  if (prevFeatureBox) {\n    container.removeChild(prevFeatureBox);\n  }\n\n  const frag = document.createDocumentFragment();\n  const {topRect, leftRect, bottomRect, rightRect} = getBoxInfo(container);\n\n  const box = document.createElement('DIV');\n  box.id = 'feature-box';\n  box.className = 'feature-box';\n  frag.appendChild(box);\n\n  const top = document.createElement('DIV');\n\n  top.style.cssText = `\n      position: absolute;\n      top: ${topRect.top}px;\n      left: ${topRect.left}px;\n      right: ${topRect.right}px;\n      bottom: ${topRect.bottom}px;\n    `;\n  top.className = 'feature-box-edge';\n  box.appendChild(top);\n\n  const left = document.createElement('DIV');\n  left.style.cssText = `\n      position: absolute;\n      top: ${leftRect.top}px;\n      left: ${leftRect.left}px;\n      right: ${leftRect.right}px;\n      bottom: ${leftRect.bottom}px;\n    `;\n  left.className = 'feature-box-edge';\n  box.appendChild(left);\n\n  const bottom = document.createElement('DIV');\n  bottom.style.cssText = `\n      position: absolute;\n      top: ${bottomRect.top}px;\n      left: ${bottomRect.left}px;\n      right: ${bottomRect.right}px;\n      bottom: ${bottomRect.bottom}px;\n    `;\n  bottom.className = 'feature-box-edge';\n  box.appendChild(bottom);\n\n  const right = document.createElement('DIV');\n  right.style.cssText = `\n      position: absolute;\n      top: ${rightRect.top}px;\n      left: ${rightRect.left}px;\n      right: ${rightRect.right}px;\n      bottom: ${rightRect.bottom}px;\n    `;\n  right.className = 'feature-box-edge';\n  box.appendChild(right);\n\n  container.appendChild(frag);\n}\n\nfunction getBoxInfo(container) {\n  const containerRect = container.getBoundingClientRect();\n  const x = containerRect.width * 0.5;\n  const y = containerRect.height * 0.5;\n  const width = 200;\n  const height = 200;\n\n  const boxRect = {\n    top: y - height * 0.5,\n    left: x - width * 0.5,\n    bottom: y + height * 0.5,\n    right: x + width * 0.5,\n  };\n  const border = 2;\n\n  const topRect = {\n    top: boxRect.top,\n    left: boxRect.left,\n    bottom: containerRect.height - boxRect.top - border,\n    right: containerRect.width - boxRect.right,\n  };\n\n  const leftRect = {\n    top: boxRect.top,\n    left: boxRect.left,\n    bottom: containerRect.height - boxRect.bottom,\n    right: containerRect.width - boxRect.left - border,\n  };\n\n  const bottomRect = {\n    top: boxRect.bottom - border,\n    left: boxRect.left,\n    bottom: containerRect.height - boxRect.bottom,\n    right: containerRect.width - boxRect.right,\n  };\n\n  const rightRect = {\n    top: boxRect.top,\n    left: boxRect.right - border,\n    bottom: containerRect.height - boxRect.bottom,\n    right: containerRect.width - boxRect.right,\n  };\n\n  return {\n    boxRect,\n    topRect,\n    leftRect,\n    rightRect,\n    bottomRect\n  }\n}\n\ndrawFeatureBox();\n\nwindow.addEventListener('resize', () => {\n  drawFeatureBox();\n});\n"],"sourceRoot":""}