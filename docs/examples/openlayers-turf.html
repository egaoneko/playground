<!DOCTYPE html>
<html lang="en-US">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-62717870-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-62717870-1');
    </script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="./resources/prism/prism.css" type="text/css">
    <link rel="stylesheet" href="./resources/layout-full.css" type="text/css">
    <link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/css/ol.css">
<script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@5/turf.min.js"></script>
    <link rel="stylesheet" href="openlayers-turf.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default%2CrequestAnimationFrame%2Cfetch%2CElement.prototype.classList%2CURL%2CMap%2CSet%2CPromise%2CObject.values"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-2.2.4.min.js"
      integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
      crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <title>Openlayers turf</title>
  </head>
  <body>
  <header class="navbar dropdown" role="navigation">
    <button type="button" class="btn btn-default dropdown-toggle" id="hamburger" data-toggle="dropdown" aria-label="hamburger" aria-haspopup="true" aria-expanded="false">
      <span class="glyphicon glyphicon glyphicon-align-justify" aria-hidden="true"></span>
    </button>
    <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="hamburger">
      <li><a class="active" href="index.html">Examples</a></li>
      <li><a href="../apidoc">API</a></li>
      <li><a href="https://github.com/egaoneko/playground">Code</a></li>
      <li role="separator" class="divider"></li>
      <li><a href="#" data-toggle="modal" data-target="#flipFlop">Source</a></li>
    </ul>
  </header>
  <div id="container" class="main">
  <div id="map"></div>
</div>


  <!-- The modal -->
  <div class="modal fade" id="flipFlop" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="modalLabel">Openlayers turf</h4>
        </div>
        <div class="modal-body">
          <div class="row-fluid">
            <div class="span12">
              <p id="shortdesc">Openlayers turf.</p>
              <div id="docs"><p>This page&#39;s Openlayers turf.</p>
</div>
              <p id="tags">Tags: openlayers</p>
            </div>
          </div>

          <div class="row-fluid">
            <div id="source-controls">
              <a id="copy-button" data-clipboard-target="#example-source"><i class="fa fa-clipboard"></i> Copy</a>
              <!-- <a id="codepen-button"><i class="fa fa-codepen"></i> Edit</a> -->
            </div>
            <form method="POST" id="codepen-form" target="_blank" action="https://codepen.io/pen/define/">
              <textarea class="hidden" name="title">Openlayers turf</textarea>
              <textarea class="hidden" name="description">Openlayers turf.</textarea>
              <textarea class="hidden" name="js">var coordinates;

// coordinates &#x3D; [
//   [
//     127.09610939025879,
//     37.351464686498815
//   ],
//   [
//     127.10108757019043,
//     37.35214697629814
//   ],
//   [
//     127.10505723953246,
//     37.354739620980915
//   ],
//   [
//     127.10668802261353,
//     37.35787796578827
//   ],
//   [
//     127.10939168930054,
//     37.35895247760407
//   ],
//   [
//     127.11222410202026,
//     37.36563798323926
//   ],
//   [
//     127.11662292480467,
//     37.352129919128714
//   ],
//   [
//     127.11984157562254,
//     37.358730754203336
//   ]
// ];

// coordinates &#x3D; [
//   [
//     127.09726810455322,
//     37.35509780827176
//   ],
//   [
//     127.10087299346922,
//     37.36492170755341
//   ],
//   [
//     127.10422039031981,
//     37.35796324506581
//   ],
//   [
//     127.10692405700685,
//     37.352419890481514
//   ],
//   [
//     127.11267471313475,
//     37.35020243402261
//   ],
//   [
//     127.11718082427977,
//     37.35721278409788
//   ],
//   [
//     127.11949825286865,
//     37.36285811318619
//   ],
//   [
//     127.12260961532593,
//     37.364068989488395
//   ],
//   [
//     127.12679386138916,
//     37.354364375319165
//   ]
// ];

coordinates &#x3D; [
  [
    127.09359884262085,
    37.35185700389112
  ],
  [
    127.09507942199708,
    37.35815085913536
  ],
  [
    127.09840536117554,
    37.364614730166345
  ],
  [
    127.10488557815552,
    37.35966881026814
  ],
  [
    127.10492849349976,
    37.35554127588281
  ],
  [
    127.1119236946106,
    37.35364799202858
  ],
  [
    127.11548566818237,
    37.361459612015395
  ],
  [
    127.11984157562254,
    37.366746491654546
  ],
  [
    127.1242833137512,
    37.35941297795872
  ],
  [
    127.12857484817505,
    37.35567772692831
  ]
];

var geojson;
var collection;

geojson &#x3D; {
  &#x27;type&#x27;: &#x27;FeatureCollection&#x27;,
  &#x27;features&#x27;: [
    {
      &#x27;type&#x27;: &#x27;Feature&#x27;,
      &#x27;properties&#x27;: {},
      &#x27;geometry&#x27;: {
        &#x27;type&#x27;: &#x27;LineString&#x27;,
        &#x27;coordinates&#x27;: coordinates
      }
    }
  ]
};

var vector1 &#x3D; new ol.layer.Vector({
  source: new ol.source.Vector({
    features: (new ol.format.GeoJSON()).readFeatures(geojson)
  }),
  style: [
    new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: &#x27;rgba(91,113,171,1.0)&#x27;,
        width: 3
      })
    }) ]
});

var line &#x3D; turf.lineString(coordinates);
var bbox &#x3D; turf.bbox(line);
var bboxPolygon &#x3D; turf.bboxPolygon(bbox);

var mid &#x3D; [(bbox[0] + bbox[2]) * 0.5, (bbox[1] + bbox[3]) * 0.5];
var lines &#x3D; [
  [[bbox[0], bbox[1]], mid],
  [[bbox[2], bbox[3]], mid],
  [[bbox[2], bbox[1]], mid],
  [[bbox[0], bbox[3]], mid]
];

var vector2 &#x3D; new ol.layer.Vector({
  source: new ol.source.Vector({
    features: (new ol.format.GeoJSON()).readFeatures(bboxPolygon)
  }),
  style: [
    new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: &#x27;rgba(42,53,81,1.0)&#x27;,
        width: 3
      }),
      fill: new ol.style.Fill({
        color: &#x27;rgba(42,53,81,0.1)&#x27;
      })
    }) ]
});

geojson &#x3D; {
  &#x27;type&#x27;: &#x27;FeatureCollection&#x27;,
  &#x27;features&#x27;: lines.map(function (line) {
    return {
      &#x27;type&#x27;: &#x27;Feature&#x27;,
      &#x27;properties&#x27;: {},
      &#x27;geometry&#x27;: {
        &#x27;type&#x27;: &#x27;LineString&#x27;,
        &#x27;coordinates&#x27;: line
      }
    };
  }),
};

var vector3 &#x3D; new ol.layer.Vector({
  source: new ol.source.Vector({
    features: (new ol.format.GeoJSON()).readFeatures(geojson)
  }),
  style: [
    new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: &#x27;rgba(42,53,81,1.0)&#x27;,
        width: 3
      })
    }) ]
});

var origin &#x3D; turf.lineString(coordinates);

var collectionFeatures &#x3D; [];
collectionFeatures &#x3D; collectionFeatures.concat(lines.map(function (line) {
    return turf.lineIntersect(origin, turf.lineString(line))
  })
    .reduce(function (prev, current) {
      return prev.concat(current.features);
    }, [])
);

function getBBoxOnLine(coordinates) {
  var size &#x3D; coordinates.length;
  var bboxes &#x3D; [];

  for (var i &#x3D; 0; i &lt; size - 2; i++) {
    bboxes.push(( coordinates[i] ).concat( coordinates[i + 1]));
  }

  return bboxes;
}

collectionFeatures &#x3D; collectionFeatures.concat(
  getBBoxOnLine(coordinates)
    .map(function (bbox) {
      return turf.bboxPolygon(bbox);
    })
);

collection &#x3D; turf.featureCollection(collectionFeatures);

var vector4 &#x3D; new ol.layer.Vector({
  source: new ol.source.Vector({
    features: (new ol.format.GeoJSON()).readFeatures(collection)
  }),
  style: function (f) {
    console.log();

    var type &#x3D; f.getGeometry().getType();
    if (type &#x3D;&#x3D;&#x3D; &#x27;Point&#x27;) {
      return new ol.style.Style({
        image: new ol.style.Circle({
          radius: 10,
          fill: null,
          stroke: new ol.style.Stroke({
            color: &#x27;rgba(249,99,99,1.0)&#x27;,
            width: 2
          })
        })
      });
    } else if (type &#x3D;&#x3D;&#x3D; &#x27;Polygon&#x27;) {
      return new ol.style.Style({
        stroke: new ol.style.Stroke({
          color: &#x27;rgba(249,99,99,1.0)&#x27;,
          width: 2
        })
      })
    }
  }
});

var map &#x3D; new ol.Map({
  layers: [
    new ol.layer.Tile({
      source: new ol.source.OSM()
    }),
    vector3,
    vector2,
    vector1,
    vector4 ],
  target: &#x27;map&#x27;,
  view: new ol.View({
    projection: &#x27;EPSG:4326&#x27;,
    center: [127.10534, 37.35941],
    zoom: 15
  })
});

window.DEBUG &#x3D; {
  map: map,
};
</textarea>
              <textarea class="hidden" name="css">/**
  * Create a position for the map
  * on the page */
#map {
  width: 100%;
  height: 100%;
}
</textarea>
              <textarea class="hidden" name="html">&lt;div id&#x3D;&quot;container&quot; class&#x3D;&quot;main&quot;&gt;
  &lt;div id&#x3D;&quot;map&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</textarea>
              <input type="hidden" name="data">
            </form>
            <pre><code id="example-source" class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Openlayers turf&lt;/title&gt;
    &lt;link rel="stylesheet" href="http://www.3daysofprogramming.com/playground/pg.css" type="text/css"&gt;
    &lt;!-- The line below is only needed for old environments like Internet Explorer and Android 4.x --&gt;
    &lt;script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL,Map,Set,Promise"&gt;&lt;/script&gt;
    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/css/ol.css&quot;&gt;
    &lt;script src&#x3D;&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;&gt;&lt;/script&gt;
    &lt;script src&#x3D;&quot;https://cdn.jsdelivr.net/npm/@turf/turf@5/turf.min.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
      /**
        * Create a position for the map
        * on the page */
      #map {
        width: 100%;
        height: 100%;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id&#x3D;&quot;container&quot; class&#x3D;&quot;main&quot;&gt;
      &lt;div id&#x3D;&quot;map&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;script&gt;
      var coordinates;

      // coordinates &#x3D; [
      //   [
      //     127.09610939025879,
      //     37.351464686498815
      //   ],
      //   [
      //     127.10108757019043,
      //     37.35214697629814
      //   ],
      //   [
      //     127.10505723953246,
      //     37.354739620980915
      //   ],
      //   [
      //     127.10668802261353,
      //     37.35787796578827
      //   ],
      //   [
      //     127.10939168930054,
      //     37.35895247760407
      //   ],
      //   [
      //     127.11222410202026,
      //     37.36563798323926
      //   ],
      //   [
      //     127.11662292480467,
      //     37.352129919128714
      //   ],
      //   [
      //     127.11984157562254,
      //     37.358730754203336
      //   ]
      // ];

      // coordinates &#x3D; [
      //   [
      //     127.09726810455322,
      //     37.35509780827176
      //   ],
      //   [
      //     127.10087299346922,
      //     37.36492170755341
      //   ],
      //   [
      //     127.10422039031981,
      //     37.35796324506581
      //   ],
      //   [
      //     127.10692405700685,
      //     37.352419890481514
      //   ],
      //   [
      //     127.11267471313475,
      //     37.35020243402261
      //   ],
      //   [
      //     127.11718082427977,
      //     37.35721278409788
      //   ],
      //   [
      //     127.11949825286865,
      //     37.36285811318619
      //   ],
      //   [
      //     127.12260961532593,
      //     37.364068989488395
      //   ],
      //   [
      //     127.12679386138916,
      //     37.354364375319165
      //   ]
      // ];

      coordinates &#x3D; [
        [
          127.09359884262085,
          37.35185700389112
        ],
        [
          127.09507942199708,
          37.35815085913536
        ],
        [
          127.09840536117554,
          37.364614730166345
        ],
        [
          127.10488557815552,
          37.35966881026814
        ],
        [
          127.10492849349976,
          37.35554127588281
        ],
        [
          127.1119236946106,
          37.35364799202858
        ],
        [
          127.11548566818237,
          37.361459612015395
        ],
        [
          127.11984157562254,
          37.366746491654546
        ],
        [
          127.1242833137512,
          37.35941297795872
        ],
        [
          127.12857484817505,
          37.35567772692831
        ]
      ];

      var geojson;
      var collection;

      geojson &#x3D; {
        &#x27;type&#x27;: &#x27;FeatureCollection&#x27;,
        &#x27;features&#x27;: [
          {
            &#x27;type&#x27;: &#x27;Feature&#x27;,
            &#x27;properties&#x27;: {},
            &#x27;geometry&#x27;: {
              &#x27;type&#x27;: &#x27;LineString&#x27;,
              &#x27;coordinates&#x27;: coordinates
            }
          }
        ]
      };

      var vector1 &#x3D; new ol.layer.Vector({
        source: new ol.source.Vector({
          features: (new ol.format.GeoJSON()).readFeatures(geojson)
        }),
        style: [
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: &#x27;rgba(91,113,171,1.0)&#x27;,
              width: 3
            })
          }) ]
      });

      var line &#x3D; turf.lineString(coordinates);
      var bbox &#x3D; turf.bbox(line);
      var bboxPolygon &#x3D; turf.bboxPolygon(bbox);

      var mid &#x3D; [(bbox[0] + bbox[2]) * 0.5, (bbox[1] + bbox[3]) * 0.5];
      var lines &#x3D; [
        [[bbox[0], bbox[1]], mid],
        [[bbox[2], bbox[3]], mid],
        [[bbox[2], bbox[1]], mid],
        [[bbox[0], bbox[3]], mid]
      ];

      var vector2 &#x3D; new ol.layer.Vector({
        source: new ol.source.Vector({
          features: (new ol.format.GeoJSON()).readFeatures(bboxPolygon)
        }),
        style: [
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: &#x27;rgba(42,53,81,1.0)&#x27;,
              width: 3
            }),
            fill: new ol.style.Fill({
              color: &#x27;rgba(42,53,81,0.1)&#x27;
            })
          }) ]
      });

      geojson &#x3D; {
        &#x27;type&#x27;: &#x27;FeatureCollection&#x27;,
        &#x27;features&#x27;: lines.map(function (line) {
          return {
            &#x27;type&#x27;: &#x27;Feature&#x27;,
            &#x27;properties&#x27;: {},
            &#x27;geometry&#x27;: {
              &#x27;type&#x27;: &#x27;LineString&#x27;,
              &#x27;coordinates&#x27;: line
            }
          };
        }),
      };

      var vector3 &#x3D; new ol.layer.Vector({
        source: new ol.source.Vector({
          features: (new ol.format.GeoJSON()).readFeatures(geojson)
        }),
        style: [
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: &#x27;rgba(42,53,81,1.0)&#x27;,
              width: 3
            })
          }) ]
      });

      var origin &#x3D; turf.lineString(coordinates);

      var collectionFeatures &#x3D; [];
      collectionFeatures &#x3D; collectionFeatures.concat(lines.map(function (line) {
          return turf.lineIntersect(origin, turf.lineString(line))
        })
          .reduce(function (prev, current) {
            return prev.concat(current.features);
          }, [])
      );

      function getBBoxOnLine(coordinates) {
        var size &#x3D; coordinates.length;
        var bboxes &#x3D; [];

        for (var i &#x3D; 0; i &lt; size - 2; i++) {
          bboxes.push(( coordinates[i] ).concat( coordinates[i + 1]));
        }

        return bboxes;
      }

      collectionFeatures &#x3D; collectionFeatures.concat(
        getBBoxOnLine(coordinates)
          .map(function (bbox) {
            return turf.bboxPolygon(bbox);
          })
      );

      collection &#x3D; turf.featureCollection(collectionFeatures);

      var vector4 &#x3D; new ol.layer.Vector({
        source: new ol.source.Vector({
          features: (new ol.format.GeoJSON()).readFeatures(collection)
        }),
        style: function (f) {
          console.log();

          var type &#x3D; f.getGeometry().getType();
          if (type &#x3D;&#x3D;&#x3D; &#x27;Point&#x27;) {
            return new ol.style.Style({
              image: new ol.style.Circle({
                radius: 10,
                fill: null,
                stroke: new ol.style.Stroke({
                  color: &#x27;rgba(249,99,99,1.0)&#x27;,
                  width: 2
                })
              })
            });
          } else if (type &#x3D;&#x3D;&#x3D; &#x27;Polygon&#x27;) {
            return new ol.style.Style({
              stroke: new ol.style.Stroke({
                color: &#x27;rgba(249,99,99,1.0)&#x27;,
                width: 2
              })
            })
          }
        }
      });

      var map &#x3D; new ol.Map({
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          }),
          vector3,
          vector2,
          vector1,
          vector4 ],
        target: &#x27;map&#x27;,
        view: new ol.View({
          projection: &#x27;EPSG:4326&#x27;,
          center: [127.10534, 37.35941],
          zoom: 15
        })
      });

      window.DEBUG &#x3D; {
        map: map,
      };
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>

  <script src="./resources/common.js"></script>
  <script src="./resources/prism/prism.min.js"></script>
  <script src="common.js"></script><script src="openlayers-turf.js"></script>
  </body>
</html>
