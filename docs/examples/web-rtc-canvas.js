(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{58:function(e,t,i){"use strict";i.r(t);var n=i(6),o=document.querySelector("#container");function r(){for(;o.firstChild;)o.removeChild(o.lastChild)}document.querySelector("#local").addEventListener("click",function(){r();var e=o.clientWidth,t=o.clientHeight,i=document.createElement("canvas");new n.a(i,{width:e,height:t,ratio:window.devicePixelRatio,images:["data/img/iu/iu01.jpg","data/img/iu/iu02.jpg","data/img/iu/iu03.jpg","data/img/iu/iu04.jpg","data/img/iu/iu05.jpg","data/img/iu/iu06.jpg"]}),o.appendChild(i),new c(i)}),document.querySelector("#remote").addEventListener("click",function(){r();var e=document.createElement("video");o.appendChild(e),e.muted=!0,e.autoplay=!0,o.appendChild(e),e.addEventListener("loadedmetadata",function(){console.log("Remote video videoWidth: "+this.videoWidth+"px, videoHeight: "+this.videoHeight+"px")}),new s(e)});var a={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]},c=function(e,t){void 0===t&&(t=a);var i=new RTCPeerConnection(t);this.pc=i,this.canvas=e;var n=e.captureStream();this.stream=n,e.srcObject=n;var o=n.getVideoTracks();o.length>0&&console.log("Using video device: "+o[0].label),n.getTracks().forEach(function(e){return i.addTrack(e,n)}),this.init()};c.prototype.init=function(){var e=this,t=this.pc;u("web-rtc-local-candidate"),u("web-rtc-local-description"),u("web-rtc-remote-candidate"),u("web-rtc-remote-description"),t.addEventListener("icecandidate",function(e){var t=e.candidate;console.log("local candidate",t),t&&p("web-rtc-local-candidate",{candidate:t.candidate,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,foundation:t.foundation,component:t.component,priority:t.priority,protocol:t.protocol,port:t.port,type:t.type,tcpType:t.tcpType,relatedAddress:t.relatedAddress,relatedPort:t.relatedPort,usernameFragment:t.usernameFragment})}),t.addEventListener("iceconnectionstatechange",function(e){return h(t,e)});var i=l("web-rtc-remote-candidate");i?this.addIceCandidate(this.pc,i):g("web-rtc-remote-candidate",function(t){return d(e.pc,t)}),t.createOffer({offerToReceiveVideo:!0}).then(function(e){p("web-rtc-local-description",{type:e.type,sdp:e.sdp}),t.setLocalDescription(e),g("web-rtc-remote-description",function(e){console.log("remote description",e),e&&t.setRemoteDescription(e)}),console.log("Added local stream")}).catch(function(t){console.log(t),e.close()})},c.prototype.close=function(){return this.stream.getTracks().forEach(function(e){return e.stop()}),u("web-rtc-local-candidate"),u("web-rtc-local-description"),this.pc.close()};var s=function(e,t){void 0===t&&(t=a),this.pc=new RTCPeerConnection(t),this.video=e,this.init()};function d(e,t){console.log("candidate",t),e.addIceCandidate(new RTCIceCandidate(t)).then(function(){console.log("ICE candidate:\n"+(t?t.candidate:"(null)"))}).catch(function(e){return console.log(e)})}function h(e,t){e&&(console.log("ICE state: "+e.iceConnectionState),console.log("ICE state change event: ",t))}function l(e){return JSON.parse(localStorage.getItem(e))}function p(e,t){localStorage.setItem(e,JSON.stringify(t))}function u(e){localStorage.removeItem(e)}s.prototype.init=function(){var e=this,t=this.pc;u("web-rtc-remote-candidate"),u("web-rtc-remote-description"),t.addEventListener("icecandidate",function(e){var t=e.candidate;console.log("remote candidate",t),t&&p("web-rtc-remote-candidate",{candidate:t.candidate,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,foundation:t.foundation,component:t.component,priority:t.priority,protocol:t.protocol,port:t.port,type:t.type,tcpType:t.tcpType,relatedAddress:t.relatedAddress,relatedPort:t.relatedPort,usernameFragment:t.usernameFragment})}),t.addEventListener("iceconnectionstatechange",function(e){return h(t,e)}),t.addEventListener("track",function(t){return e.gotRemoteStream(t)});var i=l("web-rtc-local-candidate");i?d(this.pc,i):g("web-rtc-local-candidate",function(t){return d(e.pc,t)});var n=l("web-rtc-local-description");n?this.setDescription(n):g.on("web-rtc-local-description",function(t){return e.setDescription(t)})},s.prototype.setDescription=function(e){var t=this,i=this.pc,n=this.video;console.log("local description",e),e&&i.setRemoteDescription(e).then(function(){return i.createAnswer()}).then(function(e){i.setLocalDescription(e),p("web-rtc-remote-description",{type:e.type,sdp:e.sdp}),n.srcObject=new MediaStream(i.getReceivers().map(function(e){return e.track})),console.log("Added remote stream")}).catch(function(e){console.log(e),t.close()})},s.prototype.gotRemoteStream=function(e){this.video.srcObject!==e.streams[0]&&(this.video.srcObject=e.streams[0],console.log("received remote stream"))},s.prototype.close=function(){return this.video.srcObject=null,u("web-rtc-remote-candidate"),u("web-rtc-remote-description"),this.pc.close()};var m={};function g(e,t){m[e]=t}window.addEventListener("storage",function(e){console.log(e);var t=m[e.key];t&&t(JSON.parse(e.newValue))})},6:function(e,t,i){"use strict";var n=function(e,t){e&&(t=Object.assign({width:300,height:300,ratio:1,images:[]},t),this.container=e,this.width=t.width,this.height=t.height,this.ratio=t.ratio,this.images=t.images,this.init(),this.animate())};n.prototype.init=function(){this.container.width===this.width&&this.container.width===this.height||(this.container.width=this.width,this.container.height=this.height),this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,.1,1e3),this.camera.position.x=0,this.camera.position.y=12,this.camera.position.z=28,this.camera.lookAt(new THREE.Vector3(0,0,0)),this.scene=new THREE.Scene;var e=new THREE.AmbientLight(1315860);this.scene.add(e);var t=new THREE.DirectionalLight;t.position.set(0,30,20),this.scene.add(t),this.cube=this.createMesh(new THREE.BoxGeometry(10,10,10),this.images),this.scene.add(this.cube),console.log(this.cube.geometry.faceVertexUvs),this.renderer=new THREE.WebGLRenderer({canvas:this.container,alpha:!0}),this.renderer.setClearColor(268435455,.2),this.renderer.setPixelRatio(this.ratio),this.renderer.shadowMapEnabled=!0},n.prototype.createMesh=function(e,t){var i,n=this;return i=6===t.length?new THREE.MeshFaceMaterial(t.map(function(e){return n.createMaterial(e)})):this.createMaterial(t[0]),new THREE.Mesh(e,i)},n.prototype.createMaterial=function(e){var t;t="string"==typeof e?(new THREE.TextureLoader).load(e):new THREE.CanvasTexture(e);var i=new THREE.MeshPhongMaterial;return i.map=t,i},n.prototype.animate=function(){requestAnimationFrame(this.animate.bind(this)),this.render()},n.prototype.render=function(){var e=.001*Date.now();this.cube.rotation.x=.25*e,this.cube.rotation.y=.5*e,this.renderer.render(this.scene,this.camera)},n.prototype.resize=function(e,t){this.width=e,this.height=t,this.container.width===this.width&&this.container.width===this.height||(this.container.width=this.width,this.container.height=this.height),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)},t.a=n}},[[58,0]]]);
//# sourceMappingURL=web-rtc-canvas.js.map